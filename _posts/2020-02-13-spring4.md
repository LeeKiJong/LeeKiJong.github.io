---
layout: post
title:  "Spring Framework 4"
date:   2020-02-13
author: LeeKiJong
categories: spring
comments : true
tags: JAVA Spring Framework
cover:  "/assets/java.jpg"
---
<h2>트랜잭션</h2>
: 논리적 단위로 어떤 한 부부느이 작업이 완료되었다 하더라도, 다른 부분의 작업이 완료되지 않을 경우 전체 취소되는 것.  
이 때 작업이 완ㄹ되는 것을 커밋(commit)이라고 하고, 작업이 취소되는 것을 롤백(rollback)이라고 한다.  
<h3>트랜잭션의 전체적인 구조 및 예제</h3>
예) 영화관 매표소(카드 결제, 마일리지 적립)
```java
PlatformTranscationManager transactionManager;
public void setTransactionManager(PlatformTransactionManager transactionManager){
  this.transactionManager = transactionManager;
}
public void buyTicket(final TicketDto dto){
  TransactionDefinition definition = new DefaultTransactionDefinition();
  TransactionStatus status = transactionManager.getTransaction(definition);
  try{
    // 작업1
    // 작업 2
    // 두 개 모두 성공이면 커밋 하나라도 실패하면 롤백
    transactionManager.commit(status);
  
  } catch(Exception e){
    e.printStackTrace();
    transactionManager.rollback(status);
  }
}
```
```xml
<beans:bean name = "transactionManager" class = "org.springframework.jdbc.dataSource.DataSourceTransactionManager">
  <beans:property name = "dataSource" ref = "dataSource" />
</beans:bean>
```
<h3>TransactionTemplate</h3>
```java
TransactionTemplate transactionTemplate;
public void setTemplate(JdbcTemplate template){
  this.template = template;
}
public void setTransactionTemeplate(TransactionTemplate transactionTemplate){
  this.transactionTemplate = transactionTemplate;
}
```
```xml
<beans:bean name = "transactionManager" class = "org.springframework.jdbc.dataSource.DataSourceTransactionManager">
  <beans:property name = "dataSource" ref = "dataSource" />
</beans:bean>
<beans:bean name = "transactionTemplate" class = "org.springframework.transaction.support.TransactionTemplate">
  <beans:property name = "transactionManager" ref = "transactionManager" />
</beans:bean>
```
<h3>트랜잭션 전파 속성</h3>
![13](https://user-images.githubusercontent.com/52438368/74409976-56a7c180-4e7b-11ea-8da2-45d312c77ebb.PNG)  
